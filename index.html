<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Orion</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">

    <!-- CABEÇALHO -->
    <h1>Orion</h1>
    <p class="subtitle">Clareza antes da decisão.</p>

    <!-- ASSUNTOS / ORGANIZAÇÃO DE VIDA -->
    <div class="assuntos">
      <button data-tema="geral">Geral</button>
      <button data-tema="financeiro">Financeiro</button>
      <button data-tema="trabalho">Trabalho</button>
      <button data-tema="relacionamento">Relacionamentos</button>
      <button data-tema="emocional">Emocional</button>
    </div>

    <!-- CONTROLES -->
    <div class="controls">
      <button id="mic-btn">Falar com Orion</button>
      <button id="stop-btn">Parar</button>
    </div>

    <!-- STATUS -->
    <div id="status">Orion em repouso.</div>

    <!-- CONVERSA -->
    <div id="output"></div>

  </div>

  <script>
    // ==========================
    // ELEMENTOS
    // ==========================
    const micBtn = document.getElementById("mic-btn");
    const stopBtn = document.getElementById("stop-btn");
    const status = document.getElementById("status");
    const output = document.getElementById("output");
    const botoesAssunto = document.querySelectorAll(".assuntos button");

    let isListening = false;
    let temaAtual = "geral";

    // ==========================
    // FALA (TTS)
    // ==========================
    function falar(texto) {
      if (!("speechSynthesis" in window)) return;

      speechSynthesis.cancel();

      const u = new SpeechSynthesisUtterance(texto);
      u.lang = "pt-BR";
      u.rate = 0.95;

      u.onstart = () => status.innerText = "Orion está falando...";
      u.onend = () => status.innerText = "Orion aguardando você.";

      speechSynthesis.speak(u);
    }

    stopBtn.addEventListener("click", () => {
      speechSynthesis.cancel();
      status.innerText = "Orion em silêncio.";
      isListening = false;
    });

    // ==========================
    // MEMÓRIA ORGANIZADA POR ASSUNTO
    // ==========================
    const memoriaKey = "orion_memoria_v2";

    function carregarMemoria() {
      return JSON.parse(localStorage.getItem(memoriaKey)) || {};
    }

    function salvarMemoria(memoria) {
      localStorage.setItem(memoriaKey, JSON.stringify(memoria));
    }

    // ==========================
    // REGISTRO VISUAL
    // ==========================
    function registrar(autor, texto) {
      output.innerHTML += `<strong>${autor}:</strong> ${texto}<br><br>`;
      output.scrollTop = output.scrollHeight;
    }

    // ==========================
    // RESPOSTAS BASE (MVP)
    // ==========================
    const respostas = {
      geral: "Estou com você. O que passa pela sua mente agora?",
      financeiro: "Vamos organizar sua situação financeira com calma.",
      trabalho: "Fale sobre o que está acontecendo no trabalho.",
      relacionamento: "Relacionamentos mexem fundo. O que está acontecendo?",
      emocional: "Esse peso emocional merece atenção. Pode falar."
    };

    // ==========================
    // TROCA DE ASSUNTO (PONTO-CHAVE DO PRODUTO)
    // ==========================
    botoesAssunto.forEach(btn => {
      btn.addEventListener("click", () => {
        temaAtual = btn.dataset.tema;

        registrar("Orion", `Vamos retomar o assunto: ${temaAtual}.`);
        falar(respostas[temaAtual]);

        status.innerText = `Assunto atual: ${temaAtual}`;
      });
    });

    // ==========================
    // RECONHECIMENTO DE VOZ
    // ==========================
    const SpeechRecognition =
      window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      status.innerText = "Reconhecimento de voz não suportado.";
    } else {
      const recognition = new SpeechRecognition();
      recognition.lang = "pt-BR";
      recognition.interimResults = false;
      recognition.continuous = false;

      micBtn.addEventListener("click", () => {
        if (isListening) return;

        recognition.start();
        isListening = true;
        status.innerText = "Orion ouvindo...";
      });

      recognition.onresult = (event) => {
        const texto = event.results[0][0].transcript;

        const memoria = carregarMemoria();
        memoria[temaAtual] = memoria[temaAtual] || [];
        memoria[temaAtual].push({ autor: "Você", texto });

        salvarMemoria(memoria);

        registrar("Você", texto);
        registrar("Orion", respostas[temaAtual]);

        falar(respostas[temaAtual]);
        isListening = false;
      };

      recognition.onerror = () => {
        status.innerText = "Erro ao ouvir. Tente novamente.";
        isListening = false;
      };

      recognition.onend = () => {
        isListening = false;
      };
    }
  </script>
</body>
</html>
